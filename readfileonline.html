<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <meta http-equiv="content-language" content="en" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, minimum-scale=1"
    />
    <meta charset="UTF-8" />
    <title>How to Open Big Files in Internet Browser?</title>
    <style>
      .sr {
        background: yellow;
      }
    </style>
    <script type="text/javascript">
      var V = [];
      V['rmode'] = 1;
      V['def-blocksize'] = 10000;
      V['file_start'] = 0;
      V['file_stop'] = V['blocksize'];
      V['listeners'] = [];
      V['local'] = false;
      V['trn'] = [];
      V['trn']['openfile'] = 'Open File';
      V['trn']['filesel'] = 'Files Selected:';
      V['trn']['modernbrowser'] =
        'You need a more modern browser. The File APIs are not fully supported in this browser.';
      V['trn']['filename'] = 'Opened file: ';
      V['trn']['filetype'] = 'File type: ';
      V['trn']['filesize'] = 'File size: ';
      V['trn']['filemod'] = 'Last modified: ';
      V['trn']['notfound'] = 'Not found';
      V['trn']['block'] = 'Block';
      V['trn']['cancel'] = 'Cancel';
      V['trn']['next'] = 'Next';
      V['trn']['prev'] = 'Previous';
      V['trn']['searchterm'] = 'Search terms';
      V['trn']['found'] = 'Found';
      V['trn']['stabyte'] = 'Starting byte';

      window.onload = function () {
        fireE('onload');
      };
      function numberWithCommas(a) {
        return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
      }
      addE(initial_check, this, 'onload');
      function addE(a, b, c) {
        V.listeners[c] || (V.listeners[c] = []);
        V.listeners[c][V.listeners[c].length] = { f: a, c: b };
        return this;
      }
      function fireE(a, b) {
        var c = this;
        if ('undefined' !== typeof V.listeners[a])
          for (var d = 0; d < V.listeners[a].length; d++)
            c = V.listeners[a][d].f.apply(V.listeners[a][d].c, b);
        else c = null;
        return c;
      }
      function initial_check() {
        if (!V.loaded) {
          V.loaded = !0;
          if (
            window.File &&
            window.FileReader &&
            window.FileList &&
            window.Blob
          )
            (document.getElementById('endbyte').value = V['def-blocksize']),
              (V.sroc = document.getElementById('sroc')),
              (V.srocf = !1),
              (V.fc = document.getElementById('filecontent')),
              (V.sreader = new FileReader()),
              (V.sreader.onloadend = function (b) {
                b.target.readyState === FileReader.DONE &&
                  ((V.stxt = b.target.result),
                  (V.sroc.innerHTML = V.srocf ? '/' : '\\'),
                  (V.srocf = !V.srocf),
                  fireE('scontent'));
              }),
              addE(
                function () {
                  V.sreadsofar += V.sblocksize;
                  var b = V.sreadsofar,
                    b =
                      1024 > b
                        ? b + 'B'
                        : 1048576 > b
                        ? Math.round(b / 1024) + 'KB'
                        : numberWithCommas(Math.round(b / 1048576)) + 'MB';
                  document.getElementById('ssofar').innerHTML = b;
                  0 < V.stxt.indexOf(V.sneedle)
                    ? ((V.sfound_needle = !0), fireE('search_end'))
                    : ((V.sfile_start += V.sblocksize),
                      V.sfile_start >= V.file.size
                        ? ((V.sfound_needle = !1), fireE('search_end'))
                        : V.scancel
                        ? ((V.sfound_needle = !1), fireE('search_end'))
                        : ((b = V.file.slice(
                            V.sfile_start,
                            V.sfile_start + V.sblocksize,
                          )),
                          V.sreader.readAsBinaryString(b)));
                },
                this,
                'scontent',
              ),
              addE(
                function () {
                  V.searching = !1;
                  V.st2 = new Date().getTime();
                  document.getElementById('stime').style.display =
                    'inline-block';
                  document.getElementById('stime').innerHTML = formatSecs(
                    (V.st2 - V.st1) / 1e3,
                  );
                  document.getElementById('searchtxt').disabled = !1;
                  document.getElementById('searchbut').disabled = !1;
                  V.sfound_needle
                    ? ((V['search-waiting'] = !0),
                      (V.sfoundi = 0),
                      (V.sroc.innerHTML =
                        '<a class="lined" onclick="gotofound()">' +
                        V.trn.found +
                        '!</a>'),
                      readBlob(
                        V.file,
                        V.sfile_start,
                        V.sfile_start + V.sblocksize,
                      ),
                      (document.getElementById('snext').style.display =
                        'inline-block'),
                      (document.getElementById('scancel').style.display =
                        'none'),
                      (document.getElementById('snextb').style.display =
                        'inline-block'),
                      (document.getElementById('sfoundb').style.display =
                        'inline-block'))
                    : (alert(V.trn.notfound),
                      add2SHis(
                        V.sneedle,
                        new Date(),
                        V.sfile_start,
                        V.sfile_start + V.sblocksize,
                        0,
                        V.files[V.fi],
                      ),
                      (document.getElementById('scancel').style.display =
                        'none'),
                      (document.getElementById('snext').style.display =
                        'none'));
                },
                this,
                'search_end',
              ),
              addE(
                function () {
                  if (V['search-waiting']) {
                    for (
                      var b = V.fc.innerHTML,
                        b = escape_html(b),
                        a = b.indexOf(V.sneedle),
                        d = 0;
                      0 <= a;

                    ) {
                      var e = '';
                      '>' != b.charAt(a - 1) && (e = b.charAt(a - 1));
                      var g =
                          e +
                          '<span id="found_' +
                          d +
                          '" class="sr">' +
                          V.sneedle +
                          '</span>',
                        b = b.replace(e + V.sneedle, g),
                        a = b.indexOf(V.sneedle, a + g.length + 1);
                      d++;
                    }
                    0 < d && (V.fc.innerHTML = b);
                    V.sfoundimax = d;
                    add2SHis(
                      V.sneedle,
                      new Date(),
                      V.sfile_start,
                      V.sfile_start + V.sblocksize,
                      d,
                      V.files[V.fi],
                    );
                    V['search-waiting'] = !1;
                  }
                },
                this,
                'readBlob-end',
              );
          else {
            var a = document.createElement('div');
            a.className = 'err';
            a.appendChild(document.createTextNode(V.trn.modernbrowser));
            document.getElementById('dtop').appendChild(a);
          }
          calcBSize();
        }
      }
      function escape_html(a) {
        return a.replace(/</, '&lt;').replace(/>/, '&gt;');
      }
      function escape_re(a) {
        return a
          .replace('?', '\\?')
          .replace('[', '\\[')
          .replace(']', '\\]')
          .replace('(', '\\(')
          .replace(')', '\\)')
          .replace('{', '\\{')
          .replace('}', '\\}')
          .replace('-', '\\-')
          .replace('+', '\\+')
          .replace('*', '\\*')
          .replace('.', '\\.')
          .replace('^', '\\^')
          .replace('$', '\\$');
      }
      function files_selected(a) {
        V.loaded || initial_check();
        a || (a = files_selected.arguments.callee.caller.arguments[0]);
        V.files = a.target.files;
        V.fi = -1;
        a = [];
        for (var b = 0, c; (c = V.files[b]); b++)
          (V.files[b].sizestr = formatBytes(c.size)),
            a.push(
              '<tr id="ftr' + b + '"><td>',
              escape(c.name),
              '</td><td><button id="fbut' +
                b +
                '" onclick="javascript:fileopen(' +
                b +
                ')">' +
                V.trn.openfile +
                '</button></td></tr>',
            );
        for (
          document.getElementById('filelist').innerHTML =
            '<table><tr><th>' +
            V.trn.filesel +
            '</th><th></th></tr>' +
            a.join('') +
            '</table>';
          V.fc.firstChild;

        )
          V.fc.removeChild(V.fc.firstChild);
        document.getElementById('readbts').style.display = 'none';
      }
      function f3(a) {
        a = V.files[a];
        var b = new FileReader();
        b.onload = (function (a) {
          return function (b) {
            var e = document.createElement('span');
            e.innerHTML = [
              '<img class="thumb" src="',
              b.target.result,
              '" title="',
              escape(a.name),
              '"/>',
            ].join('');
            document.getElementById('list').insertBefore(e, null);
          };
        })(a);
        b.readAsDataURL(a);
      }
      function add_listener(a, b) {
        V.listeners[a] || (V.listeners[a] = []);
        V.listeners[a].push(b);
      }
      function update_blocksize() {
        var a = parseInt(document.getElementById('stabyte').value),
          b = parseInt(document.getElementById('endbyte').value);
        V.blocksize = Math.abs(b - a);
        0 >= V.blocksize && (V.blocksize = V['def-blocksize']);
      }
      function readBlob(a, b, c) {
        document.getElementById('fileinfo').innerHTML =
          ' <span class="fileinfos"><span class="bold">' +
          V.trn.filename +
          '</span>' +
          escape(a.name) +
          '</span> <span class="fileinfos"><span class="bold">' +
          V.trn.filetype +
          '</span>' +
          (a.type || '---') +
          '</span> <span class="fileinfos"><span class="bold">' +
          V.trn.filesize +
          '</span>' +
          (a.size + 'B (' + a.sizestr + ')') +
          '</span> <span class="fileinfos"><span class="bold">' +
          V.trn.filemod +
          '</span>' +
          a.lastModifiedDate.toLocaleDateString() +
          '</span>';
        var d = b;
        0 > d ? (d = 0) : d >= a.size && (d = a.size - 1);
        var e = c;
        0 > e ? (e = 0) : e >= a.size && (e = a.size - 1);
        V.file_start = d;
        V.file_stop = e;
        b = new FileReader();
        b.onloadend = function (a) {
          a.target.readyState === FileReader.DONE &&
            ((a = a.target.result + ' '),
            (a = a.replace(/</g, '&lt;')),
            (a = a.replace(/>/g, '&gt;')),
            (V.fc.innerHTML = a),
            (document.getElementById('stabyte').value = d),
            (document.getElementById('endbyte').value = e),
            (document.getElementById('bsizei').innerHTML =
              '[' +
              V.trn.block +
              ': ' +
              formatBytes(e - d) +
              '] ' +
              V.trn.stabyte +
              ': ' +
              formatBytes(d)),
            fireE('readBlob-end'));
        };
        a = a.slice(d, e);
        b.readAsBinaryString(a);
      }
      function fileopen(a) {
        if (void 0 === a) a = V.fi;
        else if (a === V.fi) return;
        V.fc.style.display = 'block';
        for (var b = 0; b < V.files.length; b++)
          (document.getElementById('fbut' + b).disabled = b === a ? !0 : !1),
            (document.getElementById('ftr' + b).className =
              b === a ? 'activetr' : 'inactivetr');
        var b = parseInt(document.getElementById('stabyte').value),
          c = parseInt(document.getElementById('endbyte').value);
        V.blocksize = Math.abs(c - b);
        a < V.files.length &&
          V.files[a] &&
          ((V.fi = a),
          (document.getElementById('readbts').style.display = 'block'),
          c >= V.files[a].size && (c = V.files[a].size - 1),
          (V.file = V.files[a]),
          readBlob(V.files[a], b, c));
        calcBSize();
      }
      function read_block(a) {
        update_blocksize();
        var b = V.file_start;
        switch (a) {
          case 1:
            b = 0;
            break;
          case 2:
            b -= V.blocksize;
            break;
          case 3:
            b = 0 === V.file_stop ? 0 : b + V.blocksize;
            break;
          case 4:
            b = V.file.size - 1 - V.blocksize;
        }
        readBlob(V.file, b, b + V.blocksize);
        document.getElementById('snext').style.display = 'none';
        document.getElementById('scancel').style.display = 'none';
        document.getElementById('srocinfo').style.display = 'none';
      }
      function dosearch(a) {
        if (!V.searching && a && 0 != a.length) {
          document.getElementById('searchtxt').disabled = !0;
          document.getElementById('searchbut').disabled = !0;
          document.getElementById('snext').style.display = 'none';
          document.getElementById('scancel').style.display = 'inline-block';
          document.getElementById('srocinfo').style.display = 'inline';
          document.getElementById('stime').style.display = 'none';
          V.st1 = new Date().getTime();
          V.sreadsofar = 0;
          V.scancel = !1;
          var b = V.fc.innerHTML;
          if (V.sneedle)
            var c = new RegExp(
                '<span class="sr">' + escape_re(V.sneedle) + '</span>',
                'g',
              ),
              b = b.replace(c, V.sneedle);
          b = b.replace(/&lt;/, '<');
          b = b.replace(/&gt;/, '>');
          V.sneedle = a;
          V.sroc.innerHTML = '';
          0 !== a.length &&
            ((V.sstarted_byte = V.file_start),
            (V.sfile_start = V.file_start),
            (V.sblocksize = Math.max(V.blocksize, V['def-blocksize'])),
            0 <= b.indexOf(a)
              ? ((V.sfound_needle = !0), fireE('search_end'))
              : ((V.searching = !0),
                (V.stxt = ''),
                (a = V.file.slice(V.sfile_start, V.sfile_start + V.sblocksize)),
                V.sreader.readAsBinaryString(a)));
        }
      }
      function calcBSize() {
        var a = parseInt(document.getElementById('stabyte').value),
          b = parseInt(document.getElementById('endbyte').value) - a,
          c = document.getElementById('bsizei');
        V.blocksize = b;
        c.innerHTML =
          '[' +
          V.trn.block +
          ': ' +
          formatBytes(b) +
          '][' +
          V.trn.stabyte +
          ': ' +
          formatBytes(a);
      }
      function formatSecs(a) {
        return 60 > a ? a + 's' : Math.round(a / 60) + 'm';
      }
      function formatBytes(a) {
        var b = a;
        1024 > a
          ? (b += 'B')
          : 1048576 > a
          ? (b = Math.round(b / 1024) + 'KB')
          : 1073741824 > a
          ? (b = Math.round(b / 1048576) + 'MB')
          : 1099511627776 > a
          ? (b = Math.round(b / 1073741824) + 'GB')
          : 0x4000000000000 > a && (b = Math.round(b / 1099511627776) + 'TB');
        return b;
      }
      function snext() {
        V.searching ||
          ((V.fc.innerHTML = ''),
          (V.file_start += V.sblocksize),
          dosearch(V.sneedle));
      }
      function add2SHis(a, b, c, d, e, g) {
        var f = document.getElementById('shtbl');
        f.parentNode.style.display = 'block';
        f = f.getElementsByTagName('tbody')[0].insertRow();
        f.insertCell().appendChild(
          document.createTextNode(b.toLocaleTimeString()),
        );
        f.insertCell().appendChild(document.createTextNode(g.name));
        f.insertCell().appendChild(document.createTextNode(a));
        f.insertCell().appendChild(document.createTextNode(c));
        f.insertCell().appendChild(document.createTextNode(d));
        f.insertCell().appendChild(document.createTextNode(e));
      }
      function scancel() {
        V.scancel = !0;
      }
      function gotofound() {
        window.location.href = '#found_' + V.sfoundi;
        ++V.sfoundi;
        V.sfoundi >= V.sfoundimax && (V.sfoundi = 0);
      }
    </script>
  </head>
  <body>
    <div id="dbody">
      <div id="dbodyw">
        <div id="dbottom">
          <div id="filelistg">
            <input
              id="fileselector"
              class="button1"
              type="file"
              onchange="files_selected()"
              name="files[]"
              multiple
            />
            <div id="filelist"></div>
          </div>
          <div id="filecong">
            <div id="dshis" class="hid">
              <div id="shtblw">
                <table id="shtbl">
                  <thead>
                    <tr>
                      <th colspan="6">
                        <h3 style="text-align: center">Search history</h3>
                      </th>
                    </tr>
                    <tr>
                      <th>When</th>
                      <th>File</th>
                      <th>Term</th>
                      <th>Starting Byte</th>
                      <th>Ending byte</th>
                      <th>Occurences</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>
            <div id="readbts">
              <div id="fileinfo"></div>
              <div id="btg1">
                <span class="fileinfos">
                  <label for="stabyte">Starting byte</label>
                  <input
                    id="stabyte"
                    type="number"
                    value="0"
                    min="0"
                    size="8"
                    onchange="calcBSize(this)"
                  />
                </span>
                <span class="fileinfos">
                  <label for="endbyte">Ending byte</label>
                  <input
                    id="endbyte"
                    type="number"
                    value="0"
                    min="0"
                    size="8"
                    onchange="calcBSize(this)"
                  />
                </span>
                <span id="bsizei"></span>
              </div>
              <div id="btg2">
                <button onclick="fileopen();" title="Read the byte range">
                  Read
                </button>
                <button onclick="read_block(1)" title="Read first block">
                  &#9665;&#9665;
                </button>
                <button onclick="read_block(2)" title="Read previous block">
                  &#9665;
                </button>
                <button onclick="read_block(3)" title="Read next block">
                  &#9655;
                </button>
                <button onclick="read_block(4)" title="Read last block">
                  &#9655;&#9655;</button
                ><!-- &#9668; &#9658;-->
                <div id="searchd">
                  <input id="searchtxt" placeholder="Search terms &curarr;" />
                  <button
                    id="searchbut"
                    onclick="dosearch(document.getElementById('searchtxt').value);"
                  >
                    Search
                  </button>
                  <!--<a id="sprev" onclick="sprev()" class="lined hid">Previous</a> :: -->
                  <a id="scancel" onclick="scancel()" class="lined hid"
                    >Cancel</a
                  >
                  <a id="snext" onclick="snext()" class="lined hid">Next</a>
                  <span id="srocinfo" class="hid"
                    >Bytes read: <span id="ssofar"></span> (<span
                      id="stime"
                    ></span
                    >) <span id="sroc"></span
                  ></span>
                </div>
              </div>
            </div>
            <pre id="filecontent"></pre>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
